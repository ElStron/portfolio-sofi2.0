---
import Subtitle from "@src/components/atoms/Subtitle/Subtitle.astro";
---

<script>
  const loadVideo = async (iframe) => {
    const cid = "UC36_js-krsAHAEAWpEDhHtw"; //this is the Channel ID from your Youtube channel URL
    const API_key = "&api_key=wmbjfv0ybbzjsaceaojxrbm9aaelzzq2bbe7mgws"; //in order to get your free public API_key, you will need to create an acc. in https://rss2json.com/
    const channelURL = encodeURIComponent(
      `https://www.youtube.com/feeds/videos.xml?channel_id=${cid}`
    );
    const reqURL = `https://api.rss2json.com/v1/api.json?rss_url=${channelURL}&api_key=${API_key}`;
    try {
      const response = await fetch(reqURL);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const result = await response.json();

      if (result.items && result.items.length > 0) {
        const videoNumber = iframe.getAttribute("vnum");
        const link = result.items[videoNumber].link;
        const id = link.split("v=")[1];
        const thumbvid = result.items[videoNumber].image;
        iframe.setAttribute(
          "src",
          `https://youtube.com/embed/${id}?controls=1&autoplay=0`
        );

        const videoResponse = result.feed;
        console.log(videoResponse);
        const videoThumbnail = document.querySelector(
          ".youtubeThumbnail"
        ) as HTMLElement;
        if (videoResponse.image === "") {
          videoThumbnail.style.backgroundImage = `url('https://i3.ytimg.com/vi/28ATCe8AUAQ/hqdefault.jpg')`;
        } else {
          videoThumbnail.style.backgroundImage = `url(${videoResponse.image})`;
        }
      } else {
        throw new Error("No videos found in the feed.");
      }
    } catch (error) {
      console.error("Error loading video:", error);
    }
  };

  const iframes = document.getElementsByClassName("latestVideoEmbed");
  if (iframes.length > 0) {
    loadVideo(iframes[0]);
  }
</script>

<Subtitle content="My Latest Youtube video" />
<div class="youtubeThumbnail"></div>
<button class="youtube__button" >
  <img class="youtube__button__play" src="/img/icons/btn-play.svg" alt="boton to play" />
</button>

<style lang="scss" is:global
>
  .youtubeThumbnail {
    background-size: cover;
    width: 100%;
    height: 116%;
    position: absolute;
    z-index: -1;
    top: -17%;
    left: 0;
    filter: opacity(0.3);
    overflow: hidden;
  }

  .youtube__button{
    background: none ;
    width: fit-content;
  }
  .youtube__button__play{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    z-index: 1;
    filter: opacity(0);
    transition: filter .3s ease-in, transform .3s ease-in;

    &:hover{
      transform:translate(-50%, -50%) scale(.85);
    }
  }

  .youtube__card:hover  .youtube__button__play{
    filter: opacity(1);
  }


</style>
